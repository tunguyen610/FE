@{ ViewData["Title"] = "Khảo sát"; Layout = "_NovaticAdmin"; }

<!-- Include SmartWizard CSS -->
<link href="https://www.jquery-az.com/boots/css/smartWizard/smart_wizard.min.css" rel="stylesheet" type="text/css" />

<!-- Optional SmartWizard theme -->
<link href="https://www.jquery-az.com/boots/css/smartWizard/smart_wizard_theme_circles.min.css" rel="stylesheet" type="text/css" />
<link href="https://www.jquery-az.com/boots/css/smartWizard/smart_wizard_theme_arrows.min.css" rel="stylesheet" type="text/css" />
<link href="https://www.jquery-az.com/boots/css/smartWizard/smart_wizard_theme_dots.min.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="https://www.jquery-az.com/boots/js/smartWizard/jquery.smartWizard.min.js"></script>

<style>
    @@media (min-width: 992px) {
        .modal-xxl {
            width: 95% !important;
        }
    }

    .clear {
        clear: both !important;
    }

    .fa-2x {
        font-size: 1.2em !important;
    }

    #tableData tbody tr td:nth-child(2),
    #tableData thead tr th:nth-child(2) {
        /*white-space: nowrap !important;*/
        width: 200px;
        text-align: left;
        max-width: 280px;
    }

    /*    #tableData tbody tr td.column-score {
            text-align: center;
            white-space: nowrap !important;
            max-width: 140px;
        }
    */

    #tableData tbody tr td:nth-child(3),
    #tableData thead tr th:nth-child(3) {
        text-align: center;
        width: 50px;
    }

    #tableData tbody tr td:nth-child(3),
    #tableData thead tr th:nth-child(5) {
        white-space: nowrap !important;
        max-width: 120px;
        width: 120px;
    }

    #tableData .column-createdTime,
    #tableData tr:nth-last-child(3) {
        max-width: 70px !important;
        width: 70px !important;
        white-space: normal !important;
    }

    /*    #tableData tbody tr td:nth-child(8) {
            text-align: center;
            white-space: normal !important;
            max-width: 80px;
        }*/


    .sw-theme-arrows .sw-toolbar-bottom {
        /*display: none;*/
    }


    .sw-theme-arrows .sw-toolbar-top {
        display: none;
    }

    .sw-container.tab-content {
        height: 600px !important;
    }

</style>

<div class="page-header card">
    <div class="col">
        <div class="page-header-title">
            <i class="fa fa-server"></i>
            <div class="d-inline">
                <h3 class="tableTitle">Khảo sát</h3>
            </div>
        </div>

        <a href="#" id="btnAddItem" onclick="editItem(0);" class="btn btn-brand btn-elevate btn-icon-sm">
            <i class="fa fa-plus"></i>
            <span class="hideOnMobile">Thêm khảo sát</span>
        </a>
    </div>
</div>

<div class="pcoded-inner-content">
    <div class="main-body">
        <div class="page-wrapper">
            <!-- Page-body start -->
            <div class="page-body">
                <div class="card">
                    <div class="card-block novaticContainer">
                        <div class="dt-responsive table-responsive">
                            <table id="tableData" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Index</th>
                                        <th>Loại khảo sát</th>
                                        <th>Tổng điểm</th>
                                        <th>Tiêu đề</th>
                                        <th>Ngày tạo</th>


                                        <th style="width:45px;">Chỉnh sửa</th>
                                        <th>Chi tiết</th>
                                        <th>Xóa</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                                <tfoot>
                                    <tr>
                                        <th>Index</th>
                                        <th>Loại bài viết</th>
                                        <th>Tổng điểm</th>
                                        <th>Tiêu đề</th>
                                        <th>Ngày tạo</th>

                                        <th></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>

                            <div class="modal fade" id="modalSurveyWizard">
                                <div class="modal-dialog modal-lg modal-xxl">
                                    <div class="modal-content">
                                        @*<div class="modal-header bg-gradient-info">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                &times;
                                            </button>
                                            <h4 class="modal-title"><i class="fa fa-edit"></i> Chi tiết khảo sát</h4>
                                        </div>*@
                                        <div class="modal-body" style="padding:0">


                                            <div class="container-fluid">


                                                <!-- SmartWizard html -->
                                                <div id="smartwizard">
                                                    <ul>
                                                        <li><a href="#step-1">Step 1<br /><small>Các phần khảo sát</small></a></li>
                                                        <li><a href="#step-2">Step 2<br /><small>Câu hỏi khảo sát</small></a></li>
                                                        <li><a href="#step-3">Step 3<br /><small>Kết quả khảo sát</small></a></li>
                                                        @*<li><a href="#step-4">Step 4<br /><small>Step 4 description</small></a></li>*@
                                                    </ul>

                                                    <div>
                                                        <div id="step-1" class="">

                                                            <h5>Các phần trong bài khảo sát</h5>

                                                            <iframe style="width:100%; height: 600px;" src="/surveySection/admin/list?src=iframe"></iframe>


                                                        </div>


                                                        <div id="step-2" class="">

                                                            <h5>Câu hỏi trong bài khảo sát</h5>

                                                            <iframe style="width:100%; height: 600px;" src="/surveySectionQuestion/admin/list?src=iframe"></iframe>

                                                        </div>
                                                        <div id="step-3" class="">
                                                            <h5>Kết quả bài khảo sát</h5>

                                                            <iframe style="width:100%; height: 600px;" src="/surveyAccount/admin/list?src=iframe"></iframe>
                                                        </div>

                                                        @*<div id="step-4" class="">
                                                            <h2>Step 4 Content</h2>
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading">My Details</div>
                                                                <table class="table">
                                                                    <tbody>
                                                                        <tr> <th>Name:</th> <td>Your Name</td> </tr>
                                                                        <tr> <th>Email:</th> <td>abc@example.com</td> </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>*@

                                                    </div>
                                                </div>


                                            </div>


                                        </div>

                                        <div style="clear: both;"></div>
                                        <div class="modal-footer">
                                            @*<button type="button" class="btn btn-primary" data-dismiss="modal">
                                                Close
                                            </button>*@
                                        </div>
                                    </div>
                                </div>
                            </div>








                            <div class="modal fade" id="modal-id">
                                <div class="modal-dialog modal-lg modal-xxl">
                                    <div class="modal-content">
                                        <div class="modal-header bg-gradient-info">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                &times;
                                            </button>
                                            <h4 class="modal-title"><i class="fa fa-edit"></i> Chi tiết</h4>
                                        </div>
                                        <div class="modal-body">
                                            <form action="" method="POST" onsubmit="updateItem(updatingItemId); return false;" role="form">
                                                <div class="form-group col-sm-4">
                                                    <label for="">Id</label><span class="required">*</span>
                                                    <input type="number" class="form-control input-id" value="0" id="surveyId" required readonly placeholder="" name="surveyId" />
                                                </div>
                                                <div class="form-group col-sm-4 selectContainer">
                                                    <label class="">Loại khảo sát</label><span class="required">*</span>
                                                    <div class="col-sm-12">
                                                        <select name="select" required id="surveySurveyTypeId" class="form-control fill dataSelect input-surveyTypeId" style="border: 1px solid #e9ecef;"> </select>
                                                    </div>
                                                </div>
                                                <script>
                                                    var surveyTypeData =[];
                                                    function loadDataSelectSurveyType() {
                                                        return $.ajax({
                                                            url: "@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}" + 'surveyType/api/list',
                                                            type: 'GET',
                                                            async:'true',
                                                            contentType: 'application/json',
                                                            success: function(responseData) {
                                                                console.log(new Date().getSeconds()+':'+new Date().getMilliseconds()+' - loaded surveyType');
                                                                // debugger;
                                                                var data = responseData.data;
                                                                surveyTypeData = data;
                                                                data.forEach(function(item, index) {
                                                                    var data = {
                                                                        id: item.id,
                                                                        text: item.name
                                                                    };
                                                                    var newOption = new Option(data.text, data.id, false, false);
                                                                    $('#surveySurveyTypeId').append(newOption).trigger('change');
                                                                });
                                                            },
                                                            error: function(e) {
                                                                //console.log(e.message);
                                                            }
                                                        });
                                                    }
                                                    $(document).ready(function() {
                                                        //loadDataSelectSurveyType();
                                                    });
                                                </script>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">GUID</label>
                                                    <input type="text" class="form-control input-guId" id="surveyGuId" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4">
                                                    <label for="">Photo</label>
                                                    <input type="text" class="form-control input-photo" id="surveyPhoto" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">Video</label>
                                                    <input type="text" class="form-control input-video" id="surveyVideo" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">Số lượt xem</label>
                                                    <input type="number" class="form-control input-viewCount" value="0" id="surveyViewCount" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">Số lượt bình luận</label>
                                                    <input type="number" class="form-control input-commentCount" value="0" id="surveyCommentCount" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">Số lượt thích</label>
                                                    <input type="number" class="form-control input-likeCount" value="0" id="surveyLikeCount" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4" style="display: none;">
                                                    <label for="">Active</label><span class="required">*</span>
                                                    <input type="number" class="form-control input-active" value="0" id="surveyActive" placeholder="" name="active" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">URL</label>
                                                    <input type="text" class="form-control input-url" id="surveyUrl" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4 hidden">
                                                    <label for="">URL2</label>
                                                    <input type="text" class="form-control input-url2" id="surveyUrl2" placeholder="" />
                                                </div>
                                                <div class="form-group col-sm-4">
                                                    <label for="">Tổng điểm</label><span class="required">*</span>
                                                    <input type="number" class="form-control input-score" value="0" id="surveyScore" required placeholder="" name="score" />
                                                </div>
                                                <div class="form-group col-sm-4">
                                                    <label for="">Tiêu đề</label><span class="required">*</span>
                                                    <input type="text" class="form-control input-name" name="name" id="surveyName" required placeholder="" />
                                                </div>

                                                <div class="form-group col-sm-4">
                                                    <label for="">Tiêu đề tiếng Anh</label>
                                                    <input type="text" class="form-control input-name2" id="surveyName2" placeholder="" />
                                                </div>

                                                <div class="clear"></div>
                                                <div class="form-group col-sm-4">
                                                    <label for="">Mô tả</label>
                                                    <textarea class="form-control input-description" rows="2" id="surveyDescription"></textarea>
                                                </div>
                                                <div class="form-group col-sm-8">
                                                    <label for="">Nội dung</label>
                                                    <textarea class="form-control input-text" rows="2" id="surveyText"></textarea>
                                                </div>
                                                <script>
                                                    var surveyTextEditor;
                                                    //ClassicEditor.create(document.querySelector("#surveyText"))
                                                    //    .then((editor) => {
                                                    //        // console.log( 'Editor was initialized', editor );
                                                    //        surveyTextEditor = editor;
                                                    //        editor.model.document.on("change:data", (evt, data) => {
                                                    //            // debugger;
                                                    //            // console.log('Updated:'+ data );
                                                    //            $("#surveyText").val(surveyTextEditor.getData());
                                                    //        });
                                                    //    })
                                                    //    .catch((err) => {
                                                    //        console.error(err.stack);
                                                    //    });
                                                </script>

                                                <div class="clear"></div>

                                                <div class="clear"></div>

                                                <div class="form-group col-sm-4">
                                                    <label for="">Mô tả tiếng Anh</label>
                                                    <textarea class="form-control input-description2" rows="2" id="surveyDescription2"></textarea>
                                                </div>
                                                <div class="form-group col-sm-8">
                                                    <label for="">Nội dung tiếng Anh</label>
                                                    <textarea class="form-control input-text2" rows="2" id="surveyText2"></textarea>
                                                </div>
                                                <script>
                                                    var surveyText2Editor;
                                                    //ClassicEditor.create(document.querySelector("#surveyText2"))
                                                    //    .then((editor) => {
                                                    //        // console.log( 'Editor was initialized', editor );
                                                    //        surveyText2Editor = editor;
                                                    //        editor.model.document.on("change:data", (evt, data) => {
                                                    //            // debugger;
                                                    //            // console.log('Updated:'+ data );
                                                    //            $("#surveyText2").val(surveyText2Editor.getData());
                                                    //        });
                                                    //    })
                                                    //    .catch((err) => {
                                                    //        console.error(err.stack);
                                                    //    });
                                                </script>

                                                <div class="clear"></div>

                                                <div class="form-group col-sm-4">
                                                    <label for="">Ngày xuất bản </label>
                                                    <div class="input-group date datetimepicker input-publishedTime" id="surveyPublishedTimeDiv">
                                                        <input type="text" id="surveyPublishedTime" class="form-control" />
                                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="form-group col-sm-4">
                                                    <label for="">Ngày tạo </label><span class="required">*</span>
                                                    <div class="input-group date datetimepicker input-createdTime" id="surveyCreatedTimeDiv">
                                                        <input type="text" name="createdTime" id="surveyCreatedTime" required class="form-control" />
                                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                                    </div>
                                                </div>

                                                <input style="display: none;" id="hiddenSubmit" type="submit" class="btn btn-default" value="Save changes" />
                                            </form>
                                        </div>

                                        <div style="clear: both;"></div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">
                                                Đóng 
                                            </button>
                                            <button type="button" class="btn btn-primary" id="btnUpdateItem" onclick="document.getElementById('hiddenSubmit').click();">
                                                Lưu thông tin
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
            var hiddenItem = ["id","guId","photo","video","viewCount","commentCount","likeCount","active","url","url2","description","text","name2","description2","text2","publishedTime"];
            var showItem = ["surveyTypeId","score","name","createdTime"];
            var dataSource = [];
            var updatingItemId = 0;
            var tableUpdating = 0;
            var table;

            $(document).ready(function () {
                // Load data
                //loadData();
                //setTimeout(function(){loadData();}, 460);

                $.when( loadDataSelectSurveyType()).done(function( resultDataSelectSurveyTypesurveySurveyTypeId) {
                    loadData();
                });

                // includeLibrary();

                // Datetime picker
                $('.datetimepicker').datetimepicker({
                    format: 'YYYY-MM-DD HH:mm:ss'
                });

                $('.dataSelect').select2();

                $(".datetimepicker").on('dp.change', function (e) {
                    // console.log(this.value);
                    this.value = moment(this.value).format("YYYY-MM-DD HH:mm:ss");
                    // console.log(this.value);
                })

            });


    function openSurveyWizard() {
        $("#modalSurveyWizard").modal('show');
    }


            function loadData() {
                $.ajax({
                    url: "@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}"+ "survey/api/list",
                    type: "GET",
                    contentType: "application/json",
                    success: function (responseData) {
                        // debugger;
                        var data = responseData.data;
                        dataSource = data;




                        data.forEach(function (item, index) {
                            // console.log(item, index);
                            var rowContent = "";
                            rowContent += "<td style='text-align: center;'>" + (index + 1) + "</td>";
                            for (var key in item) {
                                if (item.hasOwnProperty(key)) {
                                    // console.log(key + " -> " + item[key]);
                                    if (showItem.includes(key)) {
                                        if (key != "photo") {
                                            rowContent += "<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>";
                                        }
                                        else {
                                            rowContent += "<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'><img src='" + item[key] + "' style='height:80px;' /></td>";
                                        }
                                    }
                                }
                            }
                            rowContent += "<td style='text-align: center;'><a onclick='editItem(" + item.id + ")'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>";
                            rowContent += "<td style='text-align: center;'><a onclick='openSurveyWizard() '><i class='fa fa-book fa-2x' style='color:#03a9f4'></i></a></td>";
                            rowContent += "<td style='text-align: center;'><a onclick='deleteItem(" + item.id + ")'><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>";

                            var newRow = "<tr id='row"+item.id+"' >" + rowContent + "</tr>";
                            $(newRow).appendTo($("#tableData tbody"));

                            // $("#tableData #dummyRow").after("<tr id='row"+item.id+"' >" + rowContent + "</tr>");
                        });

                        //Init datatable
                        if (tableUpdating === 0) {
                            initTablePage();
                        }

                        //update data with foreign key
                        updateTable();
                    },
                    error: function (e) {
                        //console.log(e.message);
                        initTablePage();
                    }
                });
            }

            function initTable(){
                table = $('#tableData').DataTable({
                    aLengthMenu: [
                        [-1, 10, 25, 50, 100, 200],
                        ['Tất cả', 10, 25, 50, 100, 200]
                    ],
                    'order': [
                        [1, 'desc']
                    ]
                });



                table.on('order.dt search.dt', function() {
                    table.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function(cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                $('#tableData tfoot th:not(:last-child):not(:nth-last-child(2))').each(function() {
                    var title = $(this).text();
                    $(this).html("<input type='text' class='tableFooterFilter' placeholder=' ' />");
                });

                table.columns().every(function() {
                    var that = this;

                    $('input', this.footer()).on('keyup change', function() {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });

                setTimeout(function() {
                    table.page.len(10).draw();
                }, 1000);

            }
    function initTablePage() {
        table = $('#tableData').DataTable({
            aLengthMenu: [
                //[10, 25, 50, 100, 200, -1],
                //[10, 25, 50, 100, 200, 'Tất cả']
                [-1, 10, 25, 50, 100, 200],
                ['Tất cả', 10, 25, 50, 100, 200]
            ],
            'order': [
                [1, 'desc']
            ],
            orderFixed: [[3, 'desc']],
            'rowsGroup': [1, 7],
            "oLanguage": {
                "sUrl": "/js/Vietnamese.json"
            },
            "initComplete": function (settings, json) {
                table.on('order.dt search.dt', function () {
                    table.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                $('#tableData tfoot th:not(:last-child):not(:nth-last-child(2))').each(function () {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="tableFooterFilter" value="" placeholder="Tìm kiếm ' + title + '" />');
                });

                table.columns().every(function () {
                    var that = this;
                    $('input.tableFooterFilter', this.footer()).on('keyup change', function () {
                        if (that.search() !== this.value) {
                            that.search(this.value).draw();
                        }
                    });
                });
            }
        });
        setTimeout(function () {
            table.page.len(10).draw();
        }, 1000);
    }
            function editItem(id) {
                updatingItemId = id;
                $("#modal-id").modal('show');

                let obj = getItemById(id);
                		$("#surveyId").val(id > 0 ? obj.id : "");
    		$("#surveySurveyTypeId").val(id > 0 ? obj.surveyTypeId : "");
    		$("#surveyGuId").val(id > 0 ? obj.guId : "");
    		$("#surveyPhoto").val(id > 0 ? obj.photo : "");
    		$("#surveyVideo").val(id > 0 ? obj.video : "");
    		$("#surveyViewCount").val(id > 0 ? obj.viewCount : "");
    		$("#surveyCommentCount").val(id > 0 ? obj.commentCount : "");
    		$("#surveyLikeCount").val(id > 0 ? obj.likeCount : "");
    		$("#surveyActive").val(id > 0 ? obj.active : "");
    		$("#surveyUrl").val(id > 0 ? obj.url : "");
    		$("#surveyUrl2").val(id > 0 ? obj.url2 : "");
    		$("#surveyScore").val(id > 0 ? obj.score : "");
    		$("#surveyName").val(id > 0 ? obj.name : "");
    		$("#surveyDescription").val(id > 0 ? obj.description : "");
    		$("#surveyText").val(id > 0 ? obj.text : "");
    		$("#surveyName2").val(id > 0 ? obj.name2 : "");
    		$("#surveyDescription2").val(id > 0 ? obj.description2 : "");
    		$("#surveyText2").val(id > 0 ? obj.text2 : "");
    		$("#surveyPublishedTime").val(id > 0 ? obj.publishedTime : "");
    		$("#surveyCreatedTime").val(id > 0 ? obj.createdTime : "");
    $('#surveySurveyTypeId').trigger('change');
    //surveyTextEditor.setData((id > 0 ? obj.text : ''));
    //surveyText2Editor.setData((id > 0 ? obj.text2 : ''));

                // $("#surveyId").val(id > 0 ? obj.id : "");
                // $("#surveyName").val(id > 0 ? obj.name : "");
                // $("#surveyDescription").val(id > 0 ? obj.description : "");
                // $("#surveyCreatedTime").val(id > 0 ? obj.createdTime : "");
                // $("#surveyActive").val(id > 0 ? obj.active : "");

                if(id==0){
                    $("#surveyActive").val(1);
                    $("#surveyCreatedTime").val(new Date().toISOString().replace(/T/, ' ').replace(/\..+/, ''));
                }
                else{
                    // correcting data
                    //$('#buyProvinceId').val(obj.provinceId.split(", ")).trigger('change');

                }
                formatNumber();
            }


            function updateItem(id) {
                var actionName = (id == 0 ? "Create" : "Update");
                let obj = getItemById(id);
                let objName = id > 0 ? obj.name : " ";

                validateInputNumber();

                // "id": $("#surveyId").val(),
                // "name": $("#surveyName").val(),
                // "description": $("#surveyDescription").val(),
                // "createdTime": $("#surveyCreatedTime").val(),
                // "active": $("#surveyActive").val()
                var updatingObj = {
                    		"id": $("#surveyId").val(),
    		"surveyTypeId": $("#surveySurveyTypeId").val(),
    		"guId": $("#surveyGuId").val(),
    		"photo": $("#surveyPhoto").val(),
    		"video": $("#surveyVideo").val(),
    		"viewCount": $("#surveyViewCount").val(),
    		"commentCount": $("#surveyCommentCount").val(),
    		"likeCount": $("#surveyLikeCount").val(),
    		"active": $("#surveyActive").val(),
    		"url": $("#surveyUrl").val(),
    		"url2": $("#surveyUrl2").val(),
    		"score": $("#surveyScore").val(),
    		"name": $("#surveyName").val(),
    		"description": $("#surveyDescription").val(),
    		"text": $("#surveyText").val(),
    		"name2": $("#surveyName2").val(),
    		"description2": $("#surveyDescription2").val(),
    		"text2": $("#surveyText2").val(),
    		"publishedTime": datetimeFormat($("#surveyPublishedTime").val()),
    		"createdTime": datetimeFormat($("#surveyCreatedTime").val()),

                };

                // correcting data
                //updatingObj.provinceId = updatingObj.provinceId.join(", ");


                Swal.fire({
                    title: 'Bạn có chắc không?',
                    text: "Thực hiện " + actionName + " item " + objName,
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#443',
                    confirmButtonText: 'Đồng ý!',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.value) {
                        $("#modal-id").modal('hide');

                        //CALL AJAX TO UPDATE
                        if (id > 0) {
                            $.ajax({
                                url: "@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}"+ "survey/api/update",
                                type: "POST",
                                contentType: "application/json",
                                data: JSON.stringify(updatingObj),
                                success: function (responseData) {
                                    // debugger;
                                    if (responseData.status == 200 && responseData.message === "SUCCESS") {
                                        Swal.fire(
                                            'Updated!',
                                            'Item ' + objName + ' has been successfully updated!',
                                            'success'
                                        );
                                        updateTable(id,updatingObj,"update");
                                        var updatedItemIndex= dataSource.findIndex(item => parseInt(item.id) === id);
                                        dataSource[updatedItemIndex] = updatingObj;
                                    }
                                },
                                error: function (e) {
                                    //console.log(e.message);
                                    Swal.fire(
                                        'Error!',
                                        'Couldn\'t update item, please check your data',
                                        'error'
                                    );
                                }
                            });
                        };

                        //CALL AJAX TO CREATE
                        if (id == 0) {
                            updatingObj.id = 1;
                            delete updatingObj["id"]
                            updatingObj.active = 1;
                            updatingObj.createdTime = new Date();
                            console.log(updatingObj);
                            $.ajax({
                                url:"@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}" + "survey/api/add",
                                type: "POST",
                                contentType: "application/json",
                                data: JSON.stringify(updatingObj),
                                success: function (responseData) {
                                    // debugger;
                                    if (responseData.status == 201 && responseData.message === "CREATED") {
                                        Swal.fire(
                                            'Created!',
                                            'New item has been successfully created!',
                                            'success'
                                        );
                                        updatingObj = responseData.data;
                                        dataSource.push(updatingObj);
                                        updateTable(0,updatingObj,"add");
                                    }
                                },
                                error: function (e) {
                                    //console.log(e.message);
                                    Swal.fire(
                                        'Error!',
                                        'Couldn\'t create item, please check your data',
                                        'error'
                                    );
                                }
                            });
                        }
                    }
                })
            }

            function deleteItem(id) {
                let obj = getItemById(id);
                Swal.fire({
                    title: 'Bạn có muốn xóa không?',
                    text: "Bạn sẽ không thể phục hồi lại dữ liệu này sau khi xóa!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Đồng ý!',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.value) {

                        //CALL AJAX TO DELETE
                        $.ajax({
                            url: "@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}" + "survey/api/delete",
                            type: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ "id": id }),
                            success: function (responseData) {
                                // debugger;
                                if (responseData.status == 200 && responseData.message === "SUCCESS") {
                                    Swal.fire(
                                        'Deleted!',
                                        'Item ' + obj.name + ' has been deleted.',
                                        'success'
                                    );
                                    updateTable(id,0,"delete");
                                }
                            },
                            error: function (e) {
                                //console.log(e.message);
                                Swal.fire(
                                    'Error!',
                                    'Item ' + obj.name + ' can\'t be deleted.',
                                    'error'
                                );
                            }
                        });

                    }
                })
            }

            function updateTable(id,obj,action) {
                if(action === "delete"){
                    table.row("#row"+id).remove().draw();
                }

                if(action === "add"){
                    console.log("Added:"+obj);

                    //var addedItems = [obj];
                    var addedItems = obj;
                    var addedValues =[];


                    addedItems.forEach(function (item, index) {
                        // console.log(item, index);
                        var rowContent = "";
                        addedValues.push("<td style='text-align: center;'></td>");
                        for (var key in item) {
                            if (item.hasOwnProperty(key)) {
                                // console.log(key + " -> " + item[key]);
                                if (showItem.includes(key)) {
                                    if (key != "photo") {
                                        addedValues.push ("<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>");
                                    }
                                    else {
                                        addedValues.push ("<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'><img src='" + item[key] + "' style='height:80px;' /></td>");
                                    }
                                }
                            }
                        }
                        addedValues.push("<td style='text-align: center;'><a onclick='editItem(" + item.id + ")'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>");
                        addedValues.push("<td style='text-align: center;'><a onclick='openSurveyWizard()'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>");
                        addedValues.push("<td style='text-align: center;'><a onclick='deleteItem(" + item.id + ")'><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>");

                        table.row.add(addedValues).draw();
                    });
                    // location.reload();
                }

                if(action === "update"){
                    // alert(id);
                    $(".row"+id+"-column").each(function(){
                        var propertyName = $(this).attr("property");
                        console.log(propertyName);

                        for (var key in obj) {
                            if (key === propertyName && obj.hasOwnProperty(key)) {
                                if(key === "photo"){
                                    $(this).children().attr("src",obj[key]);
                                }
                                else{
                                    this.innerText = obj[key];
                                }
                            }
                        }

                    });
                }

                //Update columns with foreign key
                // var NO_FKFKUpdateSelector = 'tr';
                // if( !(typeof(id) === 'undefined')) {
                //     NO_FKFKUpdateSelector = '#row'+id;
                // }
                // $('#tableData tbody '+NO_FKFKUpdateSelector+' td[property=NO_FKId]').each(function(){
                //     // debugger;
                //     var surveyId = parseInt($(this).attr('class').replace('row','').replace('-column',''));
                //     var surveyObj = getItemById(surveyId);
                //     var NO_FKId = parseInt(surveyObj.NO_FKId);
                //     var NO_FKObj = NO_FKData.find(item => parseInt(item.id) === NO_FKId);
                //     $(this).text(NO_FKObj.name);
                //     // console.log('FK updated for Staff '+surveyId);
                // });

                try {
                    var surveyTypeFKUpdateSelector = 'tr';
                    if( !(typeof(id) === 'undefined')) {
                        // debugger;
                        surveyTypeFKUpdateSelector = '#row'+id;
                        var surveyTypeId = parseInt(obj.surveyTypeId);
                        var surveyTypeObj = surveyTypeData.find(item => parseInt(item.id) === surveyTypeId);
                        //create data
                        //$('#tableData tbody tr:first-child td:nth-child(0)').text(surveyTypeObj.name);

                        //update data
                        $('#tableData tbody '+surveyTypeFKUpdateSelector+' td[property=surveyTypeId]').text(surveyTypeObj.name);
                        //table.cell( this ).data(surveyTypeObj.name);
                    }
                    else{
                        //Page load
                        $('#tableData tbody '+surveyTypeFKUpdateSelector+' td[property=surveyTypeId]').each(function(){
                            // debugger;
                            var surveyId = parseInt($(this).attr('class').replace('row','').replace('-column',''));
                            var surveyObj = getItemById(surveyId);
                            var surveyTypeId = parseInt(surveyObj.surveyTypeId);
                            var surveyTypeObj = surveyTypeData.find(item => parseInt(item.id) === surveyTypeId);
                            //$(this).text(surveyTypeObj.name);
                            table.cell( this ).data(surveyTypeObj.name);
                            // console.log('FK updated for Staff '+surveyId);
                        });
                    }
                } catch (error) {

                }

                formatNumber();
            }


            function getItemById(id) {
                const result = dataSource.find(item => parseInt(item.id) === id);
                return result;
            }
</script>


<script type="text/javascript">
    $(document).ready(function () {
        // Smart Wizard
        $('#smartwizard').smartWizard({
            selected: 0,
            theme: 'default',
            transitionEffect: 'slide',
            toolbarSettings: {
                toolbarPosition: 'both',
                toolbarExtraButtons: [
                    { label: 'Close', css: 'btn-success', onClick: function () { alert('Finish Clicked'); } },
                    //{ label: 'Cancel', css: 'btn-warning', onClick: function () { $('#smartwizard').smartWizard("reset"); } }
                ]
            }
        });


        // External Button Events
        $("#reset-btn").on("click", function () {
            // Reset wizard
            $('#smartwizard').smartWizard("reset");
            return true;
        });

        $("#prev-btn").on("click", function () {
            // Navigate previous
            $('#smartwizard').smartWizard("prev");
            return true;
        });

        $("#next-btn").on("click", function () {
            // Navigate next
            $('#smartwizard').smartWizard("next");
            return true;
        });

        $('#smartwizard').smartWizard("theme", "arrows");

    });
</script>  