
@{
    Layout = null;
}

    <section class="user-page section-padding" style="padding: 1rem 0">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-12 col-xs-12">
                    <div class="user-profile-box">
                        <div class="header clearfix">
                            <h2 style="font-family: unset; letter-spacing: 2px">@ViewBag.UserFullname</h2>
                            <h4>@ViewBag.AccountTypeName</h4>
                            <img src="@ViewBag.UserPhoto" alt="avatar" class="img-fluid profile-img">
                        </div>
                        <div class="detail clearfix">
                            <ul>

                                <li>
                                    <a class="active" href="/profile">
                                        <i class="fa fa-user"></i>Hồ sơ
                                    </a>
                                </li>
                                <li>
                                    <a href="/advancedSearch">
                                        <i class="fa fa-flag" aria-hidden="true"></i>Tìm kiếm nâng cao
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/readed">
                                        <i class="fa fa-list" aria-hidden="true"></i>Bài viết đã đọc
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/bookmark">
                                        <i class="fa fa-heart" aria-hidden="true"></i>Bài viết yêu thích
                                    </a>
                                </li>
                                <li>
                                    <a href="/user/comment">
                                        <i class="fa fa-list" aria-hidden="true"></i>Danh sách bình luận
                                    </a>
                                </li>
                                @*<li>
                            <a href="MyReport.aspx">
                                <i class="fa fa-flag" aria-hidden="true"></i>Báo cáo của bạn
                            </a>
                        </li>
                        <li>
                            <a href="MySurvey.aspx">
                                <i class="fa fa-edit" aria-hidden="true"></i>Bài khảo sát đã làm
                            </a>
                        </li>*@

                                <li>
                                    <a href="/user/changePassword">
                                        <i class="fa fa-lock"></i>Đổi mật khẩu
                                    </a>
                                </li>
                                <li>
                                    <a href="logout2">
                                        <i class="fa fa-sign-out"></i>Đăng xuất
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8 col-md-12 col-xs-12">
                    <div class="dashborad-box">
                        <h4 class="title">Thống kê</h4>
                        <div class="section-body">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="item">
                                        <div class="icon">
                                            <i class="mdicon mdicon-favorite" aria-hidden="true"></i>
                                        </div>
                                        <div class="info">
                                            <h6 class="number">2019</h6>
                                            <p class="type ml-1">Bài đã đọc</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="item">
                                        <div class="icon">
                                            <i class="mdicon mdicon-favorite"></i>
                                        </div>
                                        <div class="info">
                                            <h6 class="number">2019</h6>
                                            <p class="type ml-1">Bài đã bình luận</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="item mb-0">
                                        <div class="icon">
                                            <i class="mdicon mdicon-favorite"></i>
                                        </div>
                                        <div class="info">
                                            <h6 class="number">2019</h6>
                                            <p class="type ml-1">Bài yêu thích</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-lg-8 col-md-12 col-xs-12">
                    <div class="dashborad-box mb-0">
                        <h3 class="heading pt-0">Đổi mật khẩu</h3>
                        <div class="section-inforamation">
                            <form>
                                <div class="row">
                                    <div class="col-lg-12 ">
                                        <div class="form-group name">
                                            <label>Mật khẩu hiện tại</label>
                                            <input type="password" name="Mật khẩu hiện tại" class="form-control" placeholder="Mật khẩu hiện tại" id="oldPassword">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="form-group email">
                                            <label>Mật khẩu mới</label>
                                            <input type="password" name="Mật khẩu mới" class="form-control" placeholder="Mật khẩu mới" id="newsPassword">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 ">
                                        <div class="form-group subject">
                                            <label>Nhập lại mật khẩu mới</label>
                                            <input type="password" name="Nhập lại mật khẩu mới" class="form-control" placeholder="Nhập lại mật khẩu mới" id="confirmPassword">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="send-btn mt-2">

                                            <input type="button" id="submitPassword" onclick="submitChangePassword()" class="btn btn-primary btn-lg mt-2" value="Đổi mật khẩu">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function submitChangePassword() {
            debugger;
        var olpassword = $("#oldPassword").val();
        var newpassword = $("#newsPassword").val();
        var confirmpassword = $("#confirmPassword").val();
        if ((olpassword.length == 0) || (newpassword.length == 0) || (confirmpassword.length == 0)) {

            Swal.fire(
                '@ViewBag.lblError',
                'Mật khẩu chưa nhập đầy đủ!',
                'info'
            );
        }
        else if (newpassword.length < 6) {

            Swal.fire(
                '@ViewBag.lblError',
                'Độ dài tối thiểu của mật khẩu là 6 ký tự',
                'info'
            );
        }
        else if (newpassword != confirmpassword) {

            Swal.fire(
                '@ViewBag.lblError',
                'Mật khẩu mới không trùng khớp. Hãy thử lại!',
                'info'
            );
        }

        else {
            ChangePassword(olpassword,newpassword);
        }
    }

        debugger;
        function ChangePassword(olpassword,newpassword) {
            var obj = {
                "id": 1,
                "accountTypeID": 1,
                "active": 1,
                "name": "",
                "email": "",
                "username": "",
                "password": newpassword,
                "photo": "",
                "description":olpassword,
                "info": "",
                "createdTime": "2019-01-01 00:00:00",
                "phone": "",
                "address": ""

            };
            console.log(obj);
            debugger;
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/Account/api/ChangePassword",
                data: JSON.stringify(obj),
                success: function (responseData) {

                    console.log(responseData);
                    debugger;
                    if (responseData.status == 200 && responseData.message === "SUCCESS") {
                        Swal.fire(
                            '@ViewBag.lblThanhCong',
                            'Cập nhật mật khẩu thành công!',
                            'success'
                        );

                    }
                    if (responseData.status == 200 && responseData.message === "INCORRECT") {
                        Swal.fire(
                            '@ViewBag.lblError',
                            'Mật khẩu không chính xác.',
                            'error'
                        );

                    }

                },
                error: function (e) {
                    //console.log(e.message);
                    Swal.fire(
                        '@ViewBag.lblError',
                        '@ViewBag.lblCheckData',
                        'error'
                    );
                }
            });
        }

    </script>