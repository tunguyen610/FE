
@{
    Layout = null;
}

@*<h1>Username: @ViewBag.Username</h1>
    <h1>Password: @ViewBag.Password</h1>*@

<!-- START SECTION DASHBOARD -->

<style>
    .user-page.section-padding {
        padding: 1rem 0 !important;
    }
</style>

<section class="user-page section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-12 col-xs-12">
                <div class="user-profile-box">
                    <div class="header clearfix">
                        <h2 style="font-family: unset; letter-spacing: 2px">@ViewBag.UserFullname</h2>
                        <h4>@ViewBag.AccountTypeName</h4>
                        <img src="@ViewBag.Photo" alt="avatar" id="thumbnailPic" class="img-fluid profile-img">
                    </div>
                    <div class="detail clearfix">
                        <ul>

                            <li>
                                <a class="active" href="/profile">
                                    <i class="fa fa-user"></i>Hồ sơ
                                </a>
                            </li>
                            <li>
                                <a href="/advancedSearch">
                                    <i class="fa fa-flag" aria-hidden="true"></i>Tìm kiếm nâng cao
                                </a>
                            </li>
                            <li>
                                <a href="/user/readed">
                                    <i class="fa fa-list" aria-hidden="true"></i>Bài viết đã đọc
                                </a>
                            </li>
                            <li>
                                <a href="/user/bookmark">
                                    <i class="fa fa-heart" aria-hidden="true"></i>Bài viết yêu thích
                                </a>
                            </li>
                            <li>
                                <a href="/user/comment">
                                    <i class="fa fa-list" aria-hidden="true"></i>Danh sách bình luận
                                </a>
                            </li>
                            @*<li>
                                    <a href="MyReport.aspx">
                                        <i class="fa fa-flag" aria-hidden="true"></i>Báo cáo của bạn
                                    </a>
                                </li>
                                <li>
                                    <a href="MySurvey.aspx">
                                        <i class="fa fa-edit" aria-hidden="true"></i>Bài khảo sát đã làm
                                    </a>
                                </li>*@

                            <li>
                                <a href="/user/changePassword">
                                    <i class="fa fa-lock"></i>Đổi mật khẩu
                                </a>
                            </li>
                            <li>
                                <a href="/logout2">
                                    <i class="fa fa-sign-out"></i>Đăng xuất
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-12 col-xs-12">
                <div class="dashborad-box" style="display: none">
                    <h4 class="title">Thống kê</h4>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="item">
                                    <div class="icon">
                                        <i class="mdicon mdicon-favorite" aria-hidden="true"></i>
                                    </div>
                                    <div class="info">
                                        <h6 class="number">2019</h6>
                                        <p class="type ml-1">Bài đã đọc</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="item">
                                    <div class="icon">
                                        <i class="mdicon mdicon-favorite"></i>
                                    </div>
                                    <div class="info">
                                        <h6 class="number">2019</h6>
                                        <p class="type ml-1">Bài đã bình luận</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="item mb-0">
                                    <div class="icon">
                                        <i class="mdicon mdicon-favorite"></i>
                                    </div>
                                    <div class="info">
                                        <h6 class="number">2019</h6>
                                        <p class="type ml-1">Bài yêu thích</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashborad-box mb-0">
                    <h4 class="heading pt-0">Hồ sơ</h4>
                    <div class="section-inforamation">
                        <form>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Họ Tên</label>
                                        <input readonly type="text" class="form-control" id="accountName" placeholder="Nhập tên của bạn" value="@ViewBag.Name">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Loại tài khoản</label>
                                        <input readonly type="text" class="form-control" id="accountTypeName" placeholder="" value="@ViewBag.AccountTypeName">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input readonly type="text" class="form-control" id="accountEmail" placeholder="Nhập email của bạn" value="@ViewBag.Email">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Số điện thoại</label>
                                        <input readonly type="text" class="form-control" id="Phone" placeholder="Số điện thoại" value="@ViewBag.Phone">
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Giới thiệu bản thân</label>
                                        <textarea readonly name="address" class="form-control" id="accountInfo" placeholder="Địa chỉ của bạn">@ViewBag.Info</textarea>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Địa chỉ</label>
                                        <textarea readonly name="address" class="form-control" id="accountAddress" placeholder="Giới thiệu bản thân">@ViewBag.Address</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-12" style="padding-left:unset">
                                    <div class="col-sm-4">
                                        <label for="">Photo</label>
                                        <input id="buttonUploadImage" disabled="disabled" type="file" class="form-control  input-photo"
                                               placeholder="" onchange="UploadFile(event)">
                                    </div>
                                    <div class="col-sm-8">
                                        <label for="">Photo URL</label>
                                        <input readonly type="text" class="form-control  input-photo"
                                               id="postPhoto" placeholder="" value="@ViewBag.Photo">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <button type="button" id="btnChangeInfo" class="btn btn-primary btn-lg mt-2" onclick="changeInfo()">Cập nhật thông tin</button>
                                    <button type="button" style="display:none;" class="btn btn-primary btn-lg mt-2 btnSubmit" onclick="updateAccount()" id="submitVisible">Lưu thay đổi</button>
                                    <button style="display:none" type="button" onclick="Hieudz()">Hieudz</button>
                                </div>
                                <div class="col-sm-6">
                                    <a href="/user/ShowInfoUpdateAccount">
                                        <button type="button" style="position: absolute;right:15px;" id="upgradeAccountId" class="btn btn-primary btn-lg mt-2" onclick="upgradeAccount()">Nâng cấp tài khoản</button>
                                    </a>
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- END SECTION DASHBOARD -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    var UploadFile = function (e) {
        console.log(e);
        console.log(e.target.files[0].name);
        var file = e.target.files[0];
        var formData = new FormData();
        formData.append("file", file);
        axios.post("/Topic/api/SingleFile", formData);
        $("#postPhoto").val("@{@ViewBag.SystemConfigs["HOMEPAGE_URL"].Description}files/frontend/images/upload/" + e.target.files[0].name);
        setTimeout(function () { $("#thumbnailPic").attr("src", $("#postPhoto").val()); }, 1000);
    }
    $("#postPhoto").change(function () {
        $("#thumbnailPic").attr("src", $("#postPhoto").val());
    });
</script>
<script>
    //function upgradeAccount() {
    //    Swal.fire(
    //            'CÁC MỨC ĐÓNG GÓP & TRI ÂN',
    //            'lợi ích đi kèm mức đóng góp như sau: \n \
    //                • Mức ủng hộ 100.000 VNĐ sẽ được hưởng miễn phí quyền lợi thành viên trả phí trong vòng 2 tháng.\n \
    //                • Mức ủng hộ 200.000 VNĐ sẽ được hưởng miễn phí quyền lợi thành viên trả phí trong vòng 4 tháng.\n \
    //                • Mức ủng hộ 500.000 VNĐ sẽ được hưởng miễn phí quyền lợi thành viên trả phí trong vòng 12 tháng.\n \
    //                • Mức ủng hộ 1.000.000 VNĐ sẽ được hưởng miễn phí quyền lợi thành viên trả phí trong vòng 24 tháng.\n \
    //                 Khi đi vào hoạt động chính thức, thành viên đăng ký tại Gappingworld.com sẽ đóng mức phí 50k/tháng.\n \
    //                PHƯƠNG THỨC ĐÓNG GÓP\n \
    //                Các khoản góp vốn gửi về:\n \
    //                Số tài khoản: 02957054501\n \
    //                Chủ tài khoản: Phạm Thị Kim Dung\n \
    //                Ngân hàng: Tiên Phong Bank (TP Bank)'
    //                ,
    //            'info'
    //        );
    //}
    function changeInfo() {
        debugger;
        var arrList = document.getElementsByClassName('form-control');
        for (var i = 0; i < arrList.length; i++) {
            arrList[i].removeAttribute('readonly');
            $('#accountTypeName').attr('readonly', true);
        }
        $("#buttonUploadImage").prop("disabled", false);
        document.getElementById("btnChangeInfo").setAttribute("style", "display:none");
        document.getElementsByClassName("btnSubmit")[0].removeAttribute("style","display");
    }
    function updateAccount() {
        debugger;
        var updatingObj = {
            "id": @ViewBag.Id,
            "accountTypeID": @ViewBag.AccountTypeID,
            "active": @ViewBag.Active,
            "name": $("#accountName").val(),
            "email": $("#accountEmail").val(),
            "username": "@ViewBag.Username",
            "password": "@ViewBag.Password",
            "photo": $("#postPhoto").val(),
            "description": $("#accountDescription").val(),
            "info": $("#accountInfo").val(),
            "createdTime": "@ViewBag.CreatedTime",
            "phone": $("#Phone").val(),
            "address": $("#accountAddress").val(),
            "isActivated": 1,
        };
        if (updatingObj.phone.length < 10) {
            alert("Số điện thoại không chính xác");
        }
        else if (!validateEmail(updatingObj.email)) {
            alert("Nhập đúng định dạng email")
        }
        else {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "../Account/api/Update",
                data: JSON.stringify(updatingObj),
                success: function (responseData) {
                    // debugger;
                    if (responseData.status == 200 && responseData.message === "SUCCESS") {
                        window.location.href = "@Url.Action("", "UserInfo")";
                    }
                },
                error: function (e) {
                    console.log(e.message);
                }
            });
        }
    }

    function validateEmail($email) {
        var emailReg = /^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/;
        return emailReg.test( $email );
    }
</script>